# Filecoin 中的存储市场

存储市场子系统是网络的数据入口点。存储矿工只能从存储在存储交易中的数据中获取power，所有交易都在 Filecoin 网络上进行。具体的交易协商过程发生在链下，客户和矿工在达成协议后进入存储交易，并在 Filecoin 网络上发布存储交易以获得区块奖励并获得将数据存储在存储交易中的报酬。只有当交易在链上发布并由双方签名时，交易才有效，并且在发布时，双方都有足够的余额被锁定以在交易价格和交易抵押方面兑现交易。

## 交易流程

存储市场中交易的生命周期包含不同的阶段：

1. 发现- 客户识别矿工并确定他们当前的要求。
2. 谈判（带外）- 双方就交易条款达成协议，各方为交易承诺资金，数据从客户转移到供应商。
3. 发布- 交易在链上发布，使存储提供商公开对交易负责。
4. 交接- 一旦交易发布，它就会交接并由存储挖掘子系统处理。存储挖掘子系统将交易对应的数据添加到扇区，密封扇区，并告诉存储市场参与者该交易在一个扇区中，从而将交易标记为活跃。
从那时起，交易由存储挖掘子系统处理，该子系统与存储市场参与者通信以处理交易付款。

### 发现

发现是识别存储供应商（即矿工）的客户过程，这些供应商（根据交易条款达成一致）提供存储客户数据的服务。客户可以使用多种方法来识别提供者来存储他们的数据。下面的列表概述了 filecoin 实现必须提供的最低发现服务。随着网络的发展，第三方可能会构建补充或增强这些服务的系统(优化点)。

发现涉及识别提供者并确定他们当前的StorageAsk. 步骤如下：

1. 客户端查询链以检索已向 StoragePowerActor 注册为矿工的存储矿工 Actor 列表。
2. 客户端可以对每个 Storage Miner Actor 执行附加查询以确定它们的属性。其中，这些属性可以包括工作地址、扇区大小、libp2p 多地址等。
3. 一旦客户端识别出可能合适的提供者，它就会使用 直接发送 libp2p 消息Storage Query Protocol以获取每个潜在提供者的当前StorageAsk.
4. 矿工AskProtocol用他们当前的签名版本回应StorageAsk。

AStorageAsk包含客户端需要确定给定提供程序是否满足其此时的存储需求所需的所有属性。提供者应经常更新他们的请求，以确保他们提供给客户的信息是最新的。

### 谈判
